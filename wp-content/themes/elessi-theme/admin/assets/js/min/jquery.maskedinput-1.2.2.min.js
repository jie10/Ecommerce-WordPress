!function(e){var t=(e.browser.msie?"paste":"input")+".mask",n=void 0!=window.orientation;e.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"}},e.fn.extend({caret:function(e,t){if(0!=this.length){if("number"==typeof e)return t="number"==typeof t?t:e,this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(e,t);else if(this.createTextRange){var n=this.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select()}});if(this[0].setSelectionRange)e=this[0].selectionStart,t=this[0].selectionEnd;else if(document.selection&&document.selection.createRange){var n=document.selection.createRange();e=0-n.duplicate().moveStart("character",-1e5),t=e+n.text.length}return{begin:e,end:t}}},unmask:function(){return this.trigger("unmask")},mask:function(a,r){if(!a&&this.length>0){var i=e(this[0]),o=i.data("tests");return e.map(i.data("buffer"),function(e,t){return o[t]?e:null}).join("")}r=e.extend({placeholder:"_",completed:null},r);var c=e.mask.definitions,o=[],s=a.length,l=null,u=a.length;return e.each(a.split(""),function(e,t){"?"==t?(u--,s=e):c[t]?(o.push(new RegExp(c[t])),null==l&&(l=o.length-1)):o.push(null)}),this.each(function(){function i(e){for(;++e<=u&&!o[e];);return e}function f(e){for(;!o[e]&&--e>=0;);for(var t=e;u>t;t++)if(o[t]){k[t]=r.placeholder;var n=i(t);if(!(u>n&&o[t].test(k[n])))break;k[t]=k[n]}g(),p.caret(Math.max(l,e))}function h(e){for(var t=e,n=r.placeholder;u>t;t++)if(o[t]){var a=i(t),c=k[t];if(k[t]=n,!(u>a&&o[a].test(c)))break;n=c}}function d(t){var a=e(this).caret(),r=t.keyCode;return y=16>r||r>16&&32>r||r>32&&41>r,a.begin-a.end==0||y&&8!=r&&46!=r||m(a.begin,a.end),8==r||46==r||n&&127==r?(f(a.begin+(46==r?0:-1)),!1):27==r?(p.val(w),p.caret(0,b()),!1):void 0}function v(t){if(y)return y=!1,8==t.keyCode?!1:null;t=t||window.event;var n=t.charCode||t.keyCode||t.which,a=e(this).caret();if(t.ctrlKey||t.altKey||t.metaKey)return!0;if(n>=32&&125>=n||n>186){var c=i(a.begin-1);if(u>c){var s=String.fromCharCode(n);if(o[c].test(s)){h(c),k[c]=s,g();var l=i(c);e(this).caret(l),r.completed&&l==u&&r.completed.call(p)}}}return!1}function m(e,t){for(var n=e;t>n&&u>n;n++)o[n]&&(k[n]=r.placeholder)}function g(){return p.val(k.join("")).val()}function b(e){for(var t=p.val(),n=-1,a=0,i=0;u>a;a++)if(o[a]){for(k[a]=r.placeholder;i++<t.length;){var c=t.charAt(i-1);if(o[a].test(c)){k[a]=c,n=a;break}}if(i>t.length)break}else k[a]==t[i]&&a!=s&&(i++,n=a);return!e&&s>n+1?(p.val(""),m(0,u)):(e||n+1>=s)&&(g(),e||p.val(p.val().substring(0,n+1))),s?a:l}var p=e(this),k=e.map(a.split(""),function(e){return"?"!=e?c[e]?r.placeholder:e:void 0}),y=!1,w=p.val();p.data("buffer",k).data("tests",o),p.attr("readonly")||p.one("unmask",function(){p.unbind(".mask").removeData("buffer").removeData("tests")}).bind("focus.mask",function(){w=p.val();var e=b();g(),setTimeout(function(){e==a.length?p.caret(0,e):p.caret(e)},0)}).bind("blur.mask",function(){b(),p.val()!=w&&p.change()}).bind("keydown.mask",d).bind("keypress.mask",v).bind(t,function(){setTimeout(function(){p.caret(b(!0))},0)}),b()})}})}(jQuery);